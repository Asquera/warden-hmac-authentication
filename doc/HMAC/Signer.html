<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: HMAC::Signer
  
    &mdash; Documentation by YARD 0.7.2
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (S)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../HMAC.html" title="HMAC (module)">HMAC</a></span></span>
     &raquo; 
    <span class="title">Signer</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: HMAC::Signer
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">HMAC::Signer</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/hmac/signer.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Helper class that provides signing capabilites for the hmac strategies.
</p>


  </div>
</div>
<div class="tags">
  <h3>Author:</h3>
<ul class="author">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
Felix Gilcher <felix.gilcher@asquera.de>
</p>
</div>
      
    </li>
  
</ul>

</div>

  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#algorithm-instance_method" title="#algorithm (instance method)">- (Object) <strong>algorithm</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute algorithm.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_opts-instance_method" title="#default_opts (instance method)">- (Object) <strong>default_opts</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute default_opts.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#secret-instance_method" title="#secret (instance method)">- (Object) <strong>secret</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute secret.
</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#canonical_representation-instance_method" title="#canonical_representation (instance method)">- (String) <strong>canonical_representation</strong>(params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
generates the canonical representation for a given request.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate_signature-instance_method" title="#generate_signature (instance method)">- (String) <strong>generate_signature</strong>(params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Generate the signature from a hash representation.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Signer) <strong>initialize</strong>(algorithm = &quot;sha1&quot;, default_opts = {}) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
create a new HMAC instance.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sign_request-instance_method" title="#sign_request (instance method)">- (Object) <strong>sign_request</strong>(url, secret, opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
sign the given request.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sign_url-instance_method" title="#sign_url (instance method)">- (String) <strong>sign_url</strong>(url, secret, opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
convienience method to sign a url for use with query-based authentication.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate_signature-instance_method" title="#validate_signature (instance method)">- (Bool) <strong>validate_signature</strong>(signature, params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
compares the given signature with the signature created from a hash
representation.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate_url_signature-instance_method" title="#validate_url_signature (instance method)">- (Bool) <strong>validate_url_signature</strong>(url, secret, opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
convienience method to check the signature of a url with query-based
authentication.
</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="HMAC::Signer (class)">Signer</a></span></tt>) <strong>initialize</strong>(algorithm = &quot;sha1&quot;, default_opts = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
create a new HMAC instance
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>algorithm</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;sha1&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
The hashing-algorithm to use. See the openssl documentation for valid
values.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>default_opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
The default options for all calls that take opts
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <h3>Options Hash (<tt>default_opts</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="name">:auth_scheme</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'HMAC'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The name of the authorization scheme used in the Authorization header and
to construct various header-names
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_param</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'auth'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The name of the authentication param to use for query based authentication
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_header</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'Authorization'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The name of the authorization header to use
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_header_format</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'%{auth_scheme} %{signature}'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The format of the authorization header. Will be interpolated with the given
options and the signature.
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:nonce_header</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'X-#{auth_scheme}-Nonce'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The header name for the request nonce
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:alternate_date_header</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'X-#{auth_scheme}-Date'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The header name for the alternate date header
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:query_based</span>
          <span class="type">(<tt>Bool</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          &mdash; <div class='inline'><p>
Whether to use query based authentication
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:use_alternate_date_header</span>
          <span class="type">(<tt>Bool</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          &mdash; <div class='inline'><p>
Use the alternate date header instead of `Date`
</p>
</div>
        </tr>
      
    </ul>
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/hmac/signer.rb', line 27</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='id algorithm'>algorithm</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sha1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id default_opts'>default_opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id algorithm'>algorithm</span> <span class='op'>=</span> <span class='id algorithm'>algorithm</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id default_opts'>default_opts</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='symbol'>:auth_scheme</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HMAC</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='symbol'>:auth_param</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>auth</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='symbol'>:auth_header</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Authorization</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='symbol'>:auth_header_format</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%{auth_scheme} %{signature}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='symbol'>:nonce_header</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>X-%{scheme}-Nonce</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbrace'>{</span><span class='symbol'>:scheme</span> <span class='op'>=&gt;</span> <span class='lparen'>(</span><span class='id default_opts'>default_opts</span><span class='lbracket'>[</span><span class='symbol'>:auth_scheme</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HMAC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='symbol'>:alternate_date_header</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>X-%{scheme}-Date</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbrace'>{</span><span class='symbol'>:scheme</span> <span class='op'>=&gt;</span> <span class='lparen'>(</span><span class='id default_opts'>default_opts</span><span class='lbracket'>[</span><span class='symbol'>:auth_scheme</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HMAC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='symbol'>:query_based</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
    <span class='symbol'>:use_alternate_date_header</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span><span class='id default_opts'>default_opts</span><span class='rparen'>)</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="algorithm=-instance_method"></span>
      <span id="algorithm-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="algorithm-instance_method">
  
    - (<tt>Object</tt>) <strong>algorithm</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute algorithm
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/hmac/signer.rb', line 11</span>

<span class='kw'>def</span> <span class='id algorithm'>algorithm</span>
  <span class='ivar'>@algorithm</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="default_opts=-instance_method"></span>
      <span id="default_opts-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="default_opts-instance_method">
  
    - (<tt>Object</tt>) <strong>default_opts</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute default_opts
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/hmac/signer.rb', line 11</span>

<span class='kw'>def</span> <span class='id default_opts'>default_opts</span>
  <span class='ivar'>@default_opts</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="secret=-instance_method"></span>
      <span id="secret-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="secret-instance_method">
  
    - (<tt>Object</tt>) <strong>secret</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute secret
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/hmac/signer.rb', line 11</span>

<span class='kw'>def</span> <span class='id secret'>secret</span>
  <span class='ivar'>@secret</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="canonical_representation-instance_method">
  
    - (<tt>String</tt>) <strong>canonical_representation</strong>(params) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
generates the canonical representation for a given request
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the parameters to create the representation with
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <h3>Options Hash (<tt>params</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="name">:method</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
The HTTP Verb of the request
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:date</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
The date of the request as it was formatted in the request
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:nonce</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>''</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The nonce given in the request
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:path</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
The path portion of the request
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:query</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>{}</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The query parameters given in the request. Must not contain the auth param.
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:headers</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>{}</tt>
            
          </span>
          &mdash; <div class='inline'><p>
All headers given in the request (optional and required)
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_scheme</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'HMAC'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The name of the authorization scheme used in the Authorization header and
to construct various header-names
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_param</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'auth'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The name of the authentication param to use for query based authentication
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_header</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'Authorization'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The name of the authorization header to use
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_header_format</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'%{auth_scheme} %{signature}'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The format of the authorization header. Will be interpolated with the given
options and the signature.
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:nonce_header</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'X-#{auth_scheme}-Nonce'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The header name for the request nonce
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:alternate_date_header</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'X-#{auth_scheme}-Date'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The header name for the alternate date header
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:query_based</span>
          <span class="type">(<tt>Bool</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          &mdash; <div class='inline'><p>
Whether to use query based authentication
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:use_alternate_date_header</span>
          <span class="type">(<tt>Bool</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          &mdash; <div class='inline'><p>
Use the alternate date header instead of `Date`
</p>
</div>
        </tr>
      
    </ul>
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the canonical representation
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/hmac/signer.rb', line 133</span>

<span class='kw'>def</span> <span class='id canonical_representation'>canonical_representation</span><span class='lparen'>(</span><span class='id params'>params</span><span class='rparen'>)</span>
  <span class='id rep'>rep</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>

  <span class='id rep'>rep</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:method</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id upcase'>upcase</span><span class='rbrace'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span> 
  <span class='id rep'>rep</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>date:</span><span class='embexpr_beg'>#{</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:date</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='id rep'>rep</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nonce:</span><span class='embexpr_beg'>#{</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:nonce</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>

  <span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:headers</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id sort'>sort</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id pair'>pair</span><span class='op'>|</span>
    <span class='id name'>name</span><span class='comma'>,</span><span class='id value'>value</span> <span class='op'>=</span> <span class='op'>*</span><span class='id pair'>pair</span>
    <span class='id rep'>rep</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id name'>name</span><span class='period'>.</span><span class='id downcase'>downcase</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id value'>value</span><span class='rbrace'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id rep'>rep</span> <span class='op'>&lt;&lt;</span> <span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:path</span><span class='rbracket'>]</span>

  <span class='id p'>p</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:query</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id dup'>dup</span>

  <span class='kw'>if</span> <span class='op'>!</span><span class='id p'>p</span><span class='period'>.</span><span class='id empty?'>empty?</span>
    <span class='id query'>query</span> <span class='op'>=</span> <span class='id p'>p</span><span class='period'>.</span><span class='id sort'>sort</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id key'>key</span><span class='comma'>,</span> <span class='id value'>value</span><span class='op'>|</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%{key}=%{value}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbrace'>{</span>
        <span class='symbol'>:key</span> <span class='op'>=&gt;</span> <span class='const'>Rack</span><span class='op'>::</span><span class='const'>Utils</span><span class='period'>.</span><span class='id unescape'>unescape</span><span class='lparen'>(</span><span class='id key'>key</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rparen'>)</span><span class='comma'>,</span>
        <span class='symbol'>:value</span> <span class='op'>=&gt;</span> <span class='const'>Rack</span><span class='op'>::</span><span class='const'>Utils</span><span class='period'>.</span><span class='id unescape'>unescape</span><span class='lparen'>(</span><span class='id value'>value</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rparen'>)</span>
      <span class='rbrace'>}</span>
    <span class='kw'>end</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&amp;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id rep'>rep</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>?</span><span class='embexpr_beg'>#{</span><span class='id query'>query</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id rep'>rep</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="generate_signature-instance_method">
  
    - (<tt>String</tt>) <strong>generate_signature</strong>(params) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Generate the signature from a hash representation
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the parameters to create the representation with
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <h3>Options Hash (<tt>params</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="name">:secret</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
The secret to generate the signature with
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:method</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
The HTTP Verb of the request
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:date</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
The date of the request as it was formatted in the request
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:nonce</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>''</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The nonce given in the request
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:path</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
The path portion of the request
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:query</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>{}</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The query parameters given in the request. Must not contain the auth param.
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:headers</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>{}</tt>
            
          </span>
          &mdash; <div class='inline'><p>
All headers given in the request (optional and required)
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_scheme</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'HMAC'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The name of the authorization scheme used in the Authorization header and
to construct various header-names
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_param</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'auth'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The name of the authentication param to use for query based authentication
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_header</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'Authorization'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The name of the authorization header to use
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_header_format</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'%{auth_scheme} %{signature}'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The format of the authorization header. Will be interpolated with the given
options and the signature.
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:nonce_header</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'X-#{auth_scheme}-Nonce'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The header name for the request nonce
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:alternate_date_header</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'X-#{auth_scheme}-Date'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The header name for the alternate date header
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:query_based</span>
          <span class="type">(<tt>Bool</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          &mdash; <div class='inline'><p>
Whether to use query based authentication
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:use_alternate_date_header</span>
          <span class="type">(<tt>Bool</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          &mdash; <div class='inline'><p>
Use the alternate date header instead of `Date`
</p>
</div>
        </tr>
      
    </ul>
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the signature
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/hmac/signer.rb', line 62</span>

<span class='kw'>def</span> <span class='id generate_signature'>generate_signature</span><span class='lparen'>(</span><span class='id params'>params</span><span class='rparen'>)</span>
  <span class='id secret'>secret</span> <span class='op'>=</span> <span class='id params'>params</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:secret</span><span class='rparen'>)</span>
  <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>HMAC</span><span class='period'>.</span><span class='id hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='id algorithm'>algorithm</span><span class='comma'>,</span> <span class='id secret'>secret</span><span class='comma'>,</span> <span class='id canonical_representation'>canonical_representation</span><span class='lparen'>(</span><span class='id params'>params</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="sign_request-instance_method">
  
    - (<tt>Object</tt>) <strong>sign_request</strong>(url, secret, opts = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
sign the given request
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>url</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The url of the request
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>secret</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The shared secret for the signature
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
Options for the signature generation
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <h3>Options Hash (<tt>opts</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="name">:nonce</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>''</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The nonce to use in the signature
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:date</span>
          <span class="type">(<tt>String</tt>, <tt>#strftime</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>Time.now</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The date to use in the signature
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:headers</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>{}</tt>
            
          </span>
          &mdash; <div class='inline'><p>
A list of optional headers to include in the signature
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_scheme</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'HMAC'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The name of the authorization scheme used in the Authorization header and
to construct various header-names
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_param</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'auth'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The name of the authentication param to use for query based authentication
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_header</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'Authorization'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The name of the authorization header to use
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_header_format</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'%{auth_scheme} %{signature}'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The format of the authorization header. Will be interpolated with the given
options and the signature.
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:nonce_header</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'X-#{auth_scheme}-Nonce'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The header name for the request nonce
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:alternate_date_header</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'X-#{auth_scheme}-Date'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The header name for the alternate date header
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:query_based</span>
          <span class="type">(<tt>Bool</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          &mdash; <div class='inline'><p>
Whether to use query based authentication
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:use_alternate_date_header</span>
          <span class="type">(<tt>Bool</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          &mdash; <div class='inline'><p>
Use the alternate date header instead of `Date`
</p>
</div>
        </tr>
      
    </ul>
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/hmac/signer.rb', line 181</span>

<span class='kw'>def</span> <span class='id sign_request'>sign_request</span><span class='lparen'>(</span><span class='id url'>url</span><span class='comma'>,</span> <span class='id secret'>secret</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id default_opts'>default_opts</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span><span class='id opts'>opts</span><span class='rparen'>)</span>

  <span class='id uri'>uri</span> <span class='op'>=</span> <span class='const'>Addressable</span><span class='op'>::</span><span class='const'>URI</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='id url'>url</span><span class='rparen'>)</span>
  <span class='id headers'>headers</span> <span class='op'>=</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:headers</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='id date'>date</span> <span class='op'>=</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:date</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'>Time</span><span class='period'>.</span><span class='id now'>now</span><span class='period'>.</span><span class='id gmtime'>gmtime</span>
  <span class='id date'>date</span> <span class='op'>=</span> <span class='id date'>date</span><span class='period'>.</span><span class='id gmtime'>gmtime</span><span class='period'>.</span><span class='id strftime'>strftime</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%a, %e %b %Y %T GMT</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id date'>date</span><span class='period'>.</span><span class='id respond_to?'>respond_to?</span> <span class='symbol'>:strftime</span>

  <span class='id signature'>signature</span> <span class='op'>=</span> <span class='id generate_signature'>generate_signature</span><span class='lparen'>(</span><span class='symbol'>:secret</span> <span class='op'>=&gt;</span> <span class='id secret'>secret</span><span class='comma'>,</span> <span class='symbol'>:method</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GET</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:path</span> <span class='op'>=&gt;</span> <span class='id uri'>uri</span><span class='period'>.</span><span class='id path'>path</span><span class='comma'>,</span> <span class='symbol'>:date</span> <span class='op'>=&gt;</span> <span class='id date'>date</span><span class='comma'>,</span> <span class='symbol'>:nonce</span> <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:nonce</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:query</span> <span class='op'>=&gt;</span> <span class='id uri'>uri</span><span class='period'>.</span><span class='id query_values'>query_values</span><span class='comma'>,</span> <span class='symbol'>:headers</span> <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:headers</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  
  <span class='kw'>if</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:query_based</span><span class='rbracket'>]</span>
    <span class='id auth_params'>auth_params</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>date</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id date'>date</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>signature</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id signature'>signature</span>
    <span class='rbrace'>}</span>
    <span class='id auth_params'>auth_params</span><span class='lbracket'>[</span><span class='symbol'>:nonce</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:nonce</span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:nonce</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id nil?'>nil?</span>
  
    <span class='id query_values'>query_values</span> <span class='op'>=</span>  <span class='id uri'>uri</span><span class='period'>.</span><span class='id query_values'>query_values</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id query_values'>query_values</span><span class='lbracket'>[</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:auth_param</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id auth_params'>auth_params</span>
    <span class='id uri'>uri</span><span class='period'>.</span><span class='id query_values'>query_values</span> <span class='op'>=</span> <span class='id query_values'>query_values</span>
  <span class='kw'>else</span>
    <span class='id headers'>headers</span><span class='lbracket'>[</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:auth_header</span><span class='rbracket'>]</span><span class='rbracket'>]</span>   <span class='op'>=</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:auth_header_format</span><span class='rbracket'>]</span> <span class='op'>%</span> <span class='id opts'>opts</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:signature</span> <span class='op'>=&gt;</span> <span class='id signature'>signature</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='id headers'>headers</span><span class='lbracket'>[</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:nonce_header</span><span class='rbracket'>]</span><span class='rbracket'>]</span>  <span class='op'>=</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:nonce</span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:nonce</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id nil?'>nil?</span>
  
    <span class='kw'>if</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:use_alternate_date_header</span><span class='rbracket'>]</span> 
      <span class='id headers'>headers</span><span class='lbracket'>[</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:alternate_date_header</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id date'>date</span>
    <span class='kw'>else</span>
      <span class='id headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Date</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id date'>date</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='lbracket'>[</span><span class='id headers'>headers</span><span class='comma'>,</span> <span class='id uri'>uri</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="sign_url-instance_method">
  
    - (<tt>String</tt>) <strong>sign_url</strong>(url, secret, opts = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
convienience method to sign a url for use with query-based authentication
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>url</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the url to sign
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>secret</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the secret used to sign the url
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
Options controlling the singature generation
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <h3>Options Hash (<tt>opts</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="name">:auth_param</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'auth'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The name of the authentication param to use for query based authentication
</p>
</div>
        </tr>
      
    </ul>
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The signed url
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


225
226
227
228
229
230
231</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/hmac/signer.rb', line 225</span>

<span class='kw'>def</span> <span class='id sign_url'>sign_url</span><span class='lparen'>(</span><span class='id url'>url</span><span class='comma'>,</span> <span class='id secret'>secret</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id default_opts'>default_opts</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span><span class='id opts'>opts</span><span class='rparen'>)</span>
  <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:query_based</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id headers'>headers</span><span class='comma'>,</span> <span class='id url'>url</span> <span class='op'>=</span> <span class='op'>*</span><span class='id sign_request'>sign_request</span><span class='lparen'>(</span><span class='id url'>url</span><span class='comma'>,</span> <span class='id secret'>secret</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='rparen'>)</span>
  <span class='id url'>url</span>  
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="validate_signature-instance_method">
  
    - (<tt>Bool</tt>) <strong>validate_signature</strong>(signature, params) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
compares the given signature with the signature created from a hash
representation
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>signature</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the signature to compare with
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the parameters to create the representation with
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <h3>Options Hash (<tt>params</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="name">:secret</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
The secret to generate the signature with
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:method</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
The HTTP Verb of the request
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:date</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
The date of the request as it was formatted in the request
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:nonce</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>''</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The nonce given in the request
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:path</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          &mdash; <div class='inline'><p>
The path portion of the request
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:query</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>{}</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The query parameters given in the request. Must not contain the auth param.
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:headers</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>{}</tt>
            
          </span>
          &mdash; <div class='inline'><p>
All headers given in the request (optional and required)
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_scheme</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'HMAC'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The name of the authorization scheme used in the Authorization header and
to construct various header-names
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_param</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'auth'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The name of the authentication param to use for query based authentication
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_header</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'Authorization'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The name of the authorization header to use
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:auth_header_format</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'%{auth_scheme} %{signature}'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The format of the authorization header. Will be interpolated with the given
options and the signature.
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:nonce_header</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'X-#{auth_scheme}-Nonce'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The header name for the request nonce
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:alternate_date_header</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'X-#{auth_scheme}-Date'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The header name for the alternate date header
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:query_based</span>
          <span class="type">(<tt>Bool</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          &mdash; <div class='inline'><p>
Whether to use query based authentication
</p>
</div>
        </tr>
      
        <li>
          <span class="name">:use_alternate_date_header</span>
          <span class="type">(<tt>Bool</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          &mdash; <div class='inline'><p>
Use the alternate date header instead of `Date`
</p>
</div>
        </tr>
      
    </ul>
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Bool</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
true if the signature matches
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


88
89
90</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/hmac/signer.rb', line 88</span>

<span class='kw'>def</span> <span class='id validate_signature'>validate_signature</span><span class='lparen'>(</span><span class='id signature'>signature</span><span class='comma'>,</span> <span class='id params'>params</span><span class='rparen'>)</span>
  <span class='id signature'>signature</span> <span class='op'>==</span> <span class='id generate_signature'>generate_signature</span><span class='lparen'>(</span><span class='id params'>params</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="validate_url_signature-instance_method">
  
    - (<tt>Bool</tt>) <strong>validate_url_signature</strong>(url, secret, opts = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
convienience method to check the signature of a url with query-based
authentication
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>url</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the url to test
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>secret</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the secret used to sign the url
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
Options controlling the singature generation
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <h3>Options Hash (<tt>opts</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="name">:auth_param</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>'auth'</tt>
            
          </span>
          &mdash; <div class='inline'><p>
The name of the authentication param to use for query based authentication
</p>
</div>
        </tr>
      
    </ul>
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Bool</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
true if the signature is valid
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


101
102
103
104
105
106
107
108
109
110
111
112</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/hmac/signer.rb', line 101</span>

<span class='kw'>def</span> <span class='id validate_url_signature'>validate_url_signature</span><span class='lparen'>(</span><span class='id url'>url</span><span class='comma'>,</span> <span class='id secret'>secret</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id default_opts'>default_opts</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span><span class='id opts'>opts</span><span class='rparen'>)</span>
  <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:query_based</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id uri'>uri</span> <span class='op'>=</span> <span class='const'>Addressable</span><span class='op'>::</span><span class='const'>URI</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='id url'>url</span><span class='rparen'>)</span>
  <span class='id query_values'>query_values</span> <span class='op'>=</span> <span class='id uri'>uri</span><span class='period'>.</span><span class='id query_values'>query_values</span>
  <span class='id auth_params'>auth_params</span> <span class='op'>=</span> <span class='id query_values'>query_values</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:auth_param</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='id date'>date</span> <span class='op'>=</span> <span class='id auth_params'>auth_params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>date</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id nonce'>nonce</span> <span class='op'>=</span> <span class='id auth_params'>auth_params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nonce</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id validate_signature'>validate_signature</span><span class='lparen'>(</span><span class='id auth_params'>auth_params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>signature</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:secret</span> <span class='op'>=&gt;</span> <span class='id secret'>secret</span><span class='comma'>,</span> <span class='symbol'>:method</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GET</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:path</span> <span class='op'>=&gt;</span> <span class='id uri'>uri</span><span class='period'>.</span><span class='id path'>path</span><span class='comma'>,</span> <span class='symbol'>:date</span> <span class='op'>=&gt;</span> <span class='id date'>date</span><span class='comma'>,</span> <span class='symbol'>:nonce</span> <span class='op'>=&gt;</span> <span class='id nonce'>nonce</span><span class='comma'>,</span> <span class='symbol'>:query</span> <span class='op'>=&gt;</span> <span class='id query_values'>query_values</span><span class='comma'>,</span> <span class='symbol'>:headers</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Sun Jul 17 13:34:13 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.2 (ruby-1.9.2).
</div>

  </body>
</html>